---
title: "Eelgrass_biometrics_calculations_2018"
author: "Wendel Raymond"
date: "April 23, 2019"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Eelgrass biometric data calculations
From the raw cleaned data this script will export a file summarized by site ready for analysis. Major task are the calculation of dry weights of eelgrass and grazers. Other calculations include scaling transect data up to a per square meter.

## Libraries
Processing of this data will require the following
```{r libraries}
library(dplyr)
library(ggplot2)
```

## Functions
```{r standar error funciton}
## standard error of the mean fucntion to use later ##
st.er <- function(x, na.rm = TRUE) {
  stopifnot(is.numeric(x))
  return(sd(x, na.rm = na.rm)/sqrt(length(x)))
}
```

## Data to import
We want to combine a few sets of data here so that we can run meaning full analyses. These are site characterization data, eelgrass transect data, eelgrass biometrics data, sea otter index data, and site nutirent data.
```{r}
eg.bio <- read.csv("../../ALL_DATA/Eelgrass_biometrics_2018_RAW.csv", header = TRUE, stringsAsFactors = FALSE)

eg.tran <- read.csv("../../ALL_DATA/Eelgrass_transect_2018_RAW.csv", header = TRUE, stringsAsFactors = FALSE)
```

## Calculations
Subtracting out foil weights to get clean dry weights. To convert to m-sq eelgrass data should be multiplies by 55.55.
```{r calcs}
### Biometrics ###
## Shoot mass ##
eg.bio$shoot_mass <- (eg.bio$shoot_dw_foil_mass_g - eg.bio$shoot_foil_mass_g)

## Shoot mass per meter ##
eg.bio$shoot_mass_m <- (eg.bio$shoot_mass * 55.55)

## Epiphyte mass ##
eg.bio$epi_mass <- eg.bio$pad_dw_mass_g - eg.bio$pad_pre_mass_g

## Epiphyte load ##
eg.bio$epi_load <- eg.bio$epi_mass / eg.bio$shoot_mass

# Idotea mass ##
eg.bio$idotea_mass <- eg.bio$idotea_dw_foil_mass_g - eg.bio$idotea_foil_mass_g

## Limpet mass ##
eg.bio$limpet_mass <- eg.bio$limpet_dw_foil_mass_g - eg.bio$limpet_foil_mass_g

## Caprellid mass ##
eg.bio$caprellid_mass <- eg.bio$caprellid_dw_foil_mass_g - eg.bio$caprellid_foil_mass_g

## Amphipod mass ##
eg.bio$amphipod_mass <- eg.bio$amphipod_dw_foil_mass_g - eg.bio$amphipod_foil_mass_g

## Gastropod mass ##
eg.bio$gastropod_mass <- eg.bio$gastropod_dw_foil_mass_g - eg.bio$gastropod_foil_mass_g

## Convert NA to 0 ##
eg.bio[is.na(eg.bio)] <- 0

## Total grazer mass ##
eg.bio$grazer_mass <- rowSums(eg.bio[1:48, 37:41])

## Grazer load ##
eg.bio$grazer_load <- eg.bio$grazer_mass / eg.bio$shoot_mass 

### Area/Transect ###
## Eeglrass shoots m2 ##
eg.tran$eelgrass_shoots_m <- eg.tran$eelgrass_shoots_0.25msq * 4

## Eelgrass flowering shoots m2 ##
eg.tran$flowering_shoots_m <- eg.tran$flowering_shoots_0.25msq * 4

```

## Summarize by site
Caculate mean values of above for each site.
```{r site sum}
### Biometrics ###
site.bio <- eg.bio %>% 
  group_by(site) %>% 
  summarise(eg_shoot_mass = mean(shoot_mass),
            eg_shoot_mass_se = st.er(shoot_mass, na.rm = TRUE),
            eg_shoot_mass_m = mean(shoot_mass_m),
            eg_shoot_mass_m_se = st.er(shoot_mass_m, na.rm = TRUE),
            epiph_mass = mean(epi_mass),
            epiph_mass_se = st.er(epi_mass, na.rm = TRUE),
            epiph_load = mean(epi_load),
            epiph_load_se = st.er(epi_load, na.rm = TRUE),
            ido_mass = mean(idotea_mass, na.rm = TRUE),
            ido_mass_se = st.er(idotea_mass, na.rm = TRUE),
            limp_mass = mean(limpet_mass, na.rm = TRUE),
            limp_mass_se = st.er(limpet_mass, na.rm = TRUE),
            capr_mass = mean(caprellid_mass, na.rm = TRUE),
            capr_mass_se = st.er(caprellid_mass, na.rm = TRUE),
            amph_mass = mean(amphipod_mass, na.rm = TRUE),
            amph_mass_se = st.er(amphipod_mass, na.rm = TRUE),
            gast_mass = mean(gastropod_mass, na.rm = TRUE),
            gast_mass_se = st.er(gastropod_mass, na.rm = TRUE),
            all_crust_mass = mean((idotea_mass + caprellid_mass + amphipod_mass), na.rm = TRUE),
            all_crust_mass_se = st.er((idotea_mass + caprellid_mass + amphipod_mass), na.rm = TRUE),
            all_gast_mass = mean((limpet_mass + gastropod_mass), na.rm = TRUE),
            all_gast_mass_se = st.er((limpet_mass + gastropod_mass), na.rm = TRUE),
            graz_mass = mean(grazer_mass),
            graz_mass_se = st.er(grazer_mass, na.rm = TRUE),
            graz_load = mean(grazer_load),
            graz_load_se = st.er(grazer_load, na.rm = TRUE))

## Transect ##
site.tran <- eg.tran %>% 
  group_by(site) %>% 
  summarise(macro_cover = mean(macroalgae_cover_0.25msq, na.rm = TRUE),
            macro_cover_se = st.er(macroalgae_cover_0.25msq, na.rm = TRUE),
            diatom_cover = mean(diatom_cover_0.25msq, na.rm = TRUE),
            diatom_cover_se = st.er(diatom_cover_0.25msq, na.rm = TRUE),
            eelgrass_shoot_dens = mean(eelgrass_shoots_m, na.rm = TRUE),
            eelgrass_shoot_dens_se = st.er(eelgrass_shoots_m, na.rm = TRUE),
            flowering_shoot_dens = mean(flowering_shoots_m, na.rm = TRUE),
            flowering_shoot_dens_se = st.er(flowering_shoots_m, na.rm = TRUE),
            sed_prime = mean(primary_sediment_score),
            sed_prime_se = st.er(primary_sediment_score),
            sed_second  = mean(secondary_sediment_score),
            sed_second_se = st.er(secondary_sediment_score))
```

## Combine
Combine summarized data
```{r comb}
dat <- merge(unique(eg.tran[,c(1:9, 11)]), site.tran, by = "site")
dat <- merge(dat, site.bio, by = "site")
```

## Export
```{r export}
write.csv(dat, "../../ALL_DATA/Eelgrass_biometrics_2018_derived.csv", row.names = FALSE)
```

