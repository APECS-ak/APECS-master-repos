---
title: "Eelgrass_community_structure_analyses"
author: "Wendel Raymond"
date: "January 16, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r libraries}
library(ggplot2)
library(dplyr)

theme_set(theme_classic())
```


# Analyses for testing hypotheses related to eelgrass community structure
**Question** 
What is the structure of eelgrass communities across a gradient of sea otter impacts?

**Overall Hypothesis**
If top-down (sea otter) forces are structuring eelgrass communities, then we would expect alternating relative abundance from trophic level to trophic level.

## Outline
1. Description of data
2. Testing assumptions
    + normality
    + co-linearity
3. Models

## 1. Data
**Response metrics**
1. eelgrass shoot density (count / m^2^)
2. eelgrass aboveground biomass density (g / m^2^)
3. eelgrass belowground biomass density (g / m^2^)
4. ratio of aboveground to belowground biomass density (g / m^2^)
5. epiphyte load (g epiphyte / g eelgrass)
6. total grazer load (g grazers/ g eelgrass)
    + gastropod load (g grazers/ g eelgrass)
    + crustaecean load (g grazers/ g eelgrass)
7. crab biomass (g)
8. fish standarized by ... candidates are length, gape size, biomass

**Primary explanatory factors**
Not all these fators will necessarily be used in all models
1. Time
2. Sediment type (primary sediment type from the "inside" eelgrass transect)
3. Percent light

**Secondary explanatory factors**
Factors that are more specific to certain tests
1. crab biomass (g)
2. fish

```{r import data, echo = FALSE, message = FALSE, warning = FALSE}
tran.dat <- read.csv( "../ALL_DATA/eelgrass_bio_sed_transect_derived.csv", header = TRUE, stringsAsFactors = FALSE)
```

## 2. Testing assumptions

### Normality
Response metrics should have approximatley normal distribution. For this exploration we can omit the NA rows that allowed for merging with sediment data. We will also omit the April sites (L01 and H01). Resulting data frame should have 19 X 9 rows = 152
```{r}
tran.dat <- tran.dat %>% 
  filter(site != "2017_L_01" & site != "2017_H_01") %>% 
  filter(quadrat < 9)
```

Eelgrass shoot density appears reasonably normal but fails SW test. Further test indicate that sqrt transformation achives normality.
```{r shoot dens normality}
## Raw data ##
ggplot(tran.dat, aes(eelgrass_shoots_msq)) +
  geom_histogram(bins = 10) +
  labs(x = "Eelgrass shoot density", y = "Counts")

qqnorm(tran.dat$eelgrass_shoots_msq)
qqline(tran.dat$eelgrass_shoots_msq, lwd = 2)

shapiro.test(tran.dat$eelgrass_shoots_msq)

## ln transformation ##
ggplot(tran.dat, aes(log(eelgrass_shoots_msq))) +
  geom_histogram(bins = 10) +
  labs(x = "log Eelgrass shoot density", y = "Counts")

qqnorm(log(tran.dat$eelgrass_shoots_msq))
qqline(log(tran.dat$eelgrass_shoots_msq), lwd = 2)

shapiro.test(log(tran.dat$eelgrass_shoots_msq))

## sqrt transfrormation ##
ggplot(tran.dat, aes(sqrt(eelgrass_shoots_msq))) +
  geom_histogram(binwidth = 1) +
  labs(x = "sqrt Eelgrass shoot density", y = "Counts")

qqnorm(sqrt(tran.dat$eelgrass_shoots_msq))
qqline(sqrt(tran.dat$eelgrass_shoots_msq), lwd = 2)

shapiro.test(sqrt(tran.dat$eelgrass_shoots_msq))
```

Aboveground biomass shows some right skewness suggesting ln transformation. Log transformation was not super great. However square roor transformation appears more helpful. SW tests all indicate at least some non-normality, but sqrt transformation is the best.
```{r ag normality}
## Raw data ##
ggplot(tran.dat, aes(ag_mass)) +
  geom_histogram() +
  labs(x = "Aboveground biomass", y = "Counts")

qqnorm(tran.dat$ag_mass)
qqline(tran.dat$ag_mass, lwd = 2)

shapiro.test(tran.dat$ag_mass)

## ln transformed ##
ggplot(tran.dat, aes(log(ag_mass))) +
  geom_histogram() +
  labs(x = "log Aboveground biomass", y = "Counts")

qqnorm(log(tran.dat$ag_mass))
qqline(log(tran.dat$ag_mass), lwd = 2)

shapiro.test(log(tran.dat$ag_mass))

## sqrt transformation ##
ggplot(tran.dat, aes(sqrt(ag_mass))) +
  geom_histogram() +
  labs(x = "sqrt Aboveground biomass", y = "Counts")

qqnorm(sqrt(tran.dat$ag_mass))
qqline(sqrt(tran.dat$ag_mass), lwd = 2)

shapiro.test(sqrt(tran.dat$ag_mass))
```

Belowground biomass also shows right skewness. Both log and square root tranformations improve normality. SW test indicates that log transformation achieves normality.
```{r bg normality}
## Raw data ##
ggplot(tran.dat, aes(bg_mass)) +
  geom_histogram() +
  labs(x = "Belowground biomass", y = "Counts")

qqnorm(tran.dat$bg_mass)
qqline(tran.dat$bg_mass, lwd = 2)

shapiro.test(tran.dat$bg_mass)

## ln transformed ##
ggplot(tran.dat, aes(log(bg_mass))) +
  geom_histogram() +
  labs(x = "log Belowground biomass", y = "Counts")

qqnorm(log(tran.dat$bg_mass))
qqline(log(tran.dat$bg_mass), lwd = 2)

shapiro.test(log(tran.dat$bg_mass))

## sqrt transformation ##
ggplot(tran.dat, aes(sqrt(bg_mass))) +
  geom_histogram() +
  labs(x = "sqrt belowground biomass", y = "Counts")

qqnorm(sqrt(tran.dat$bg_mass))
qqline(sqrt(tran.dat$bg_mass), lwd = 2)

shapiro.test(sqrt(tran.dat$bg_mass))
```

Ratio of above to belowground biomass also appears right skewed. SW test indicates that log transformation is best.
```{r agbg normality}
## Raw data ##
ggplot(tran.dat, aes(ag_mass / bg_mass)) +
  geom_histogram() +
  labs(x = "AG:BG biomass", y = "Counts")

qqnorm(tran.dat$ag_mass / tran.dat$bg_mass)
qqline(tran.dat$ag_mass / tran.dat$bg_mass, lwd = 2)

## ln transformed ##
ggplot(tran.dat, aes(log(ag_mass / bg_mass))) +
  geom_histogram() +
  labs(x = "log AG:BG biomass", y = "Counts")

qqnorm(log(tran.dat$ag_mass / tran.dat$bg_mass))
qqline(log(tran.dat$ag_mass / tran.dat$bg_mass), lwd = 2)

shapiro.test(log(tran.dat$ag_mass / tran.dat$bg_mass))

## sqrt transformation ##
ggplot(tran.dat, aes(sqrt(ag_mass / bg_mass))) +
  geom_histogram() +
  labs(x = "sqrt AG:BG biomass", y = "Counts")

qqnorm(sqrt(tran.dat$ag_mass / tran.dat$bg_mass))
qqline(sqrt(tran.dat$ag_mass / tran.dat$bg_mass), lwd = 2)

shapiro.test(sqrt(tran.dat$ag_mass / tran.dat$bg_mass))
```

Epiphyte load. This one is a bit tricky, any sort of tranformation does not deal with the outliers well. 
```{r epi load normality}
## Raw data ##
ggplot(tran.dat, aes(epimass_shootmass)) +
  geom_histogram() +
  labs(x = "Epiphyte load", y = "Counts")

qqnorm(tran.dat$epimass_shootmass)
qqline(tran.dat$epimass_shootmass, lwd = 2)

## ln transformed ##
ggplot(tran.dat, aes(log(epimass_shootmass + 0.1))) +
  geom_histogram() +
  labs(x = "log Epiphyte load", y = "Counts")

qqnorm(log(tran.dat$epimass_shootmass + 0.1))
qqline(log(tran.dat$epimass_shootmass + 0.1), lwd = 2)

shapiro.test(log(tran.dat$epimass_shootmass + 0.1))

## sqrt transformation ##
ggplot(tran.dat, aes(sqrt(epimass_shootmass))) +
  geom_histogram() +
  labs(x = "sqrt Epiphyte load", y = "Counts")

qqnorm(sqrt(tran.dat$epimass_shootmass))
qqline(sqrt(tran.dat$epimass_shootmass), lwd = 2)

shapiro.test(sqrt(tran.dat$epimass_shootmass))
```

Grazer load does not respond well to any transformation. Given the distribution of the raw data it may be best to keep it the way it is.
```{r grazer load normality}
## raw data ##
ggplot(tran.dat, aes(grazmass_shootmass)) +
  geom_histogram(bins = 20) +
  labs(x = "Grazer load", y = "Count")

## ln transformation ##
ggplot(tran.dat, aes(log(grazmass_shootmass + 0.1))) +
  geom_histogram(bins = 10) +
  labs(x = " log Grazer load", y = "Count")

shapiro.test(log(tran.dat$grazmass_shootmass + 0.1))

## sqrt transformation ##
ggplot(tran.dat, aes(sqrt(grazmass_shootmass))) +
  geom_histogram(bins = 10) +
  labs(x = " sqrt Grazer load", y = "Count")

shapiro.test(sqrt(tran.dat$grazmass_shootmass))
```

Gastropod load also does not respond super well to transformations.
```{r gastropod load normality}
## raw data ##
ggplot(tran.dat, aes(gastromass_shootmass)) +
  geom_histogram(bins = 20) +
  labs(x = "Grazer load", y = "Count")

## ln transformation ##
ggplot(tran.dat, aes(log(gastromass_shootmass + 0.1))) +
  geom_histogram(bins = 10) +
  labs(x = " log Grazer load", y = "Count")

shapiro.test(log(tran.dat$gastromass_shootmass + 0.1))

## sqrt transformation ##
ggplot(tran.dat, aes(sqrt(gastromass_shootmass))) +
  geom_histogram(bins = 10) +
  labs(x = " sqrt Grazer load", y = "Count")

shapiro.test(sqrt(tran.dat$gastromass_shootmass))
```

Crustacean load also does not respond super well to transformations.
```{r}
## raw data ##
ggplot(tran.dat, aes(crustmass_shootmass)) +
  geom_histogram(bins = 20) +
  labs(x = "Grazer load", y = "Count")

## ln transformation ##
ggplot(tran.dat, aes(log(crustmass_shootmass + 0.1))) +
  geom_histogram(bins = 10) +
  labs(x = " log Grazer load", y = "Count")

shapiro.test(log(tran.dat$crustmass_shootmass + 0.1))

## sqrt transformation ##
ggplot(tran.dat, aes(sqrt(crustmass_shootmass))) +
  geom_histogram(bins = 10) +
  labs(x = " sqrt Grazer load", y = "Count")

shapiro.test(sqrt(tran.dat$crustmass_shootmass))
```
