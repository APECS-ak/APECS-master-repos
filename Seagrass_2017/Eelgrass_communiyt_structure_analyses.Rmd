---
title: "Eelgrass_community_structure_analyses"
author: "Wendel Raymond"
date: "January 16, 2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r libraries}
library(ggplot2)

theme_set(theme_classic())
```


# Analyses for testing hypotheses related to eelgrass community structure
**Question** 
What is the structure of eelgrass communities across a gradient of sea otter impacts?

**Overall Hypothesis**
If top-down (sea otter) forces are structuring eelgrass communities, then we would expect alternating relative abundance from trophic level to trophic level.

## Outline
1. Description of data
2. Testing assumptions
    + normality
    + co-linearity
3. Models

## 1. Data
**Response metrics**
1. eelgrass shoot density (count / m^2^)
2. eelgrass aboveground biomass density (g / m^2^)
3. eelgrass belowground biomass density (g / m^2^)
4. ratio of aboveground to belowground biomass density (g / m^2^)
5. epiphyte load (g epiphyte / g eelgrass)
6. total grazer load (g grazers/ g eelgrass)
    + gastropod load (g grazers/ g eelgrass)
    + crustaecean load (g grazers/ g eelgrass)
7. crab biomass (g)
8. fish standarized by ... candidates are length, gape size, biomass

**Primary explanatory factors**
Not all these fators will necessarily be used in all models
1. Time
2. Sediment type (primary sediment type from the "inside" eelgrass transect)
3. Percent light

**Secondary explanatory factors**
Factors that are more specific to certain tests
1. crab biomass (g)
2. fish

```{r import data, echo = FALSE, message = FALSE, warning = FALSE}
eg.graz <- read.csv( "../ALL_DATA/eelgrass_bio_sed_transect_derived.csv", header = TRUE, stringsAsFactors = FALSE)
```

## 2. Testing assumptions

### Normality
Response metrics should have approximatley normal distribution.

Eelgrass shoot density appears reasonably normal but fails SW test. Further test indicate that sqrt transformation achives normality.
```{r shoot dens normality}
## Raw data ##
ggplot(eg.graz, aes(eelgrass_shoots_msq)) +
  geom_histogram(binwidth = 10) +
  labs(x = "Eelgrass shoot density", y = "Counts")

qqnorm(eg.graz$eelgrass_shoots_msq)
qqline(eg.graz$eelgrass_shoots_msq, lwd = 2)

shapiro.test(eg.graz$eelgrass_shoots_msq)

## ln transformation ##
ggplot(eg.graz, aes(log(eelgrass_shoots_msq))) +
  geom_histogram(binwidth = 0.1) +
  labs(x = "log Eelgrass shoot density", y = "Counts")

qqnorm(log(eg.graz$eelgrass_shoots_msq))
qqline(log(eg.graz$eelgrass_shoots_msq), lwd = 2)

shapiro.test(log(eg.graz$eelgrass_shoots_msq))

## sqrt transfrormation ##
ggplot(eg.graz, aes(sqrt(eelgrass_shoots_msq))) +
  geom_histogram(binwidth = 1) +
  labs(x = "sqrt Eelgrass shoot density", y = "Counts")

qqnorm(sqrt(eg.graz$eelgrass_shoots_msq))
qqline(sqrt(eg.graz$eelgrass_shoots_msq), lwd = 2)

shapiro.test(sqrt(eg.graz$eelgrass_shoots_msq))
```

Aboveground biomass shows some right skewness suggesting ln transformation. Log transformation was not super great. However square roor transformation appears more helpful. SW tests all indicate at least some non-normality, but sqrt transformation is the best.
```{r ag normality}
## Raw data ##
ggplot(eg.graz, aes(ag_mass)) +
  geom_histogram() +
  labs(x = "Aboveground biomass", y = "Counts")

qqnorm(eg.graz$ag_mass)
qqline(eg.graz$ag_mass, lwd = 2)

shapiro.test(eg.graz$ag_mass)

## ln transformed ##
ggplot(eg.graz, aes(log(ag_mass))) +
  geom_histogram() +
  labs(x = "log Aboveground biomass", y = "Counts")

qqnorm(log(eg.graz$ag_mass))
qqline(log(eg.graz$ag_mass), lwd = 2)

shapiro.test(log(eg.graz$ag_mass))

## sqrt transformation ##
ggplot(eg.graz, aes(sqrt(ag_mass))) +
  geom_histogram() +
  labs(x = "sqrt Aboveground biomass", y = "Counts")

qqnorm(sqrt(eg.graz$ag_mass))
qqline(sqrt(eg.graz$ag_mass), lwd = 2)

shapiro.test(sqrt(eg.graz$ag_mass))
```

Belowground biomass also shows right skewness. Both log and square root tranformations improve normality. SW test indicates that log transformation achieves normality.
```{r bg normality}
## Raw data ##
ggplot(eg.graz, aes(bg_mass)) +
  geom_histogram() +
  labs(x = "Belowground biomass", y = "Counts")

qqnorm(eg.graz$bg_mass)
qqline(eg.graz$bg_mass, lwd = 2)

shapiro.test(eg.graz$bg_mass)

## ln transformed ##
ggplot(eg.graz, aes(log(bg_mass))) +
  geom_histogram() +
  labs(x = "log Belowground biomass", y = "Counts")

qqnorm(log(eg.graz$bg_mass))
qqline(log(eg.graz$bg_mass), lwd = 2)

shapiro.test(log(eg.graz$bg_mass))

## sqrt transformation ##
ggplot(eg.graz, aes(sqrt(bg_mass))) +
  geom_histogram() +
  labs(x = "sqrt belowground biomass", y = "Counts")

qqnorm(sqrt(eg.graz$bg_mass))
qqline(sqrt(eg.graz$bg_mass), lwd = 2)

shapiro.test(sqrt(eg.graz$bg_mass))
```

Ration of above to belowground biomass also appears right skewed. SW test indicates that log transformation is best.
```{r agbg normality}
## Raw data ##
ggplot(eg.graz, aes(ag_mass / bg_mass)) +
  geom_histogram() +
  labs(x = "AG:BG biomass", y = "Counts")

qqnorm(eg.graz$ag_mass / eg.graz$bg_mass)
qqline(eg.graz$ag_mass / eg.graz$bg_mass, lwd = 2)

## ln transformed ##
ggplot(eg.graz, aes(log(ag_mass / bg_mass))) +
  geom_histogram() +
  labs(x = "log AG:BG biomass", y = "Counts")

qqnorm(log(eg.graz$ag_mass / eg.graz$bg_mass))
qqline(log(eg.graz$ag_mass / eg.graz$bg_mass), lwd = 2)

shapiro.test(log(eg.graz$ag_mass / eg.graz$bg_mass))

## sqrt transformation ##
ggplot(eg.graz, aes(sqrt(ag_mass / bg_mass))) +
  geom_histogram() +
  labs(x = "sqrt AG:BG biomass", y = "Counts")

qqnorm(sqrt(eg.graz$ag_mass / eg.graz$bg_mass))
qqline(sqrt(eg.graz$ag_mass / eg.graz$bg_mass), lwd = 2)

shapiro.test(sqrt(eg.graz$ag_mass / eg.graz$bg_mass))
```

Epiphyte load
```{r epi load normality}
## Raw data ##
ggplot(eg.graz, aes(s_epi_mass)) +
  geom_histogram() +
  labs(x = "Epiphyte biomass", y = "Counts")

qqnorm(eg.graz$ag_mass / eg.graz$bg_mass)
qqline(eg.graz$ag_mass / eg.graz$bg_mass, lwd = 2)

## ln transformed ##
ggplot(eg.graz, aes(log(s_epi_mass))) +
  geom_histogram() +
  labs(x = "log Epiphyte biomass", y = "Counts")

qqnorm(log(eg.graz$ag_mass / eg.graz$bg_mass))
qqline(log(eg.graz$ag_mass / eg.graz$bg_mass), lwd = 2)

shapiro.test(log(eg.graz$ag_mass / eg.graz$bg_mass))

## sqrt transformation ##
ggplot(eg.graz, aes(sqrt(ag_mass / bg_mass))) +
  geom_histogram() +
  labs(x = "sqrt AG:BG biomass", y = "Counts")

qqnorm(sqrt(eg.graz$ag_mass / eg.graz$bg_mass))
qqline(sqrt(eg.graz$ag_mass / eg.graz$bg_mass), lwd = 2)

shapiro.test(sqrt(eg.graz$ag_mass / eg.graz$bg_mass))
```

