---
title: "Stable Isotopes - Time and Seasonality"
author: "Nicole LaRoche"
date: "11/4/2019"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


# Introduction
Here are some graphs from my chapter 1 analysis of sea otter vibrissae and prey through stable isotope analysis


### Libraries and data

```{r, libraries and data, message= FALSE}
library(ggplot2)
library(dplyr)
library(tidyr)
library(ggthemes)
library(scales)
library(cowplot)
library(gridExtra)
library(grid)

#load whisker data
whisker <- read.csv("whisker_final.csv")
whisker$OtterID<-as.character(whisker$OtterID)

#load prey data
si.prey <- read.csv("sifinal.csv")
```


# All otters over time

Sea otter vibrissae from root to tip with varying δ15N (red line, primary y-axis) and δ13C (green line, secondary y-axis) patterns. The x-axis is the distance from the root of vibrissa (closest to muzzle) to tip with the maximum length of 8 cm. 

```{r, graph indiv otters, warning= FALSE}
ggplot(data=whisker) +
  geom_line(aes(x=distance, y=N), colour="tomato") +
  geom_line(aes(x=distance, y=C+25), colour="lightseagreen") +
  labs(x= "Distance from root (cm)", 
       y=expression(paste(delta^15, "N (\u2030)" )), 
       colour = "Isotope")  +
  scale_y_continuous(sec.axis = sec_axis(~.-25, 
       name = expression(paste(delta^13, "C (\u2030)" )))) +
  facet_wrap(vars(OtterID), nrow=5) +
  theme_light()
```

## More in depth vibrissae over time

Individual 520 (A) shows little variation of both carbon and nitrogen with a negative correlation closer to the root and positive correlation closer to the tip. Individual 521 (B) shows a high variation in both carbon and nitrogen which are positively correlated. Individual 524 (C) does not exhibit a correlation between carbon and nitrogen. Individual 287 (D) has a high correlation between carbon and nitrogen.

```{r, graph 4 otters over time, message = FALSE, warning= FALSE, error=FALSE}
a <- ggplot(data=filter(whisker, OtterID=="163520")) +   theme_few() +
  geom_line(aes(x=distance, y=N)) +
  geom_point(aes(x=distance, y=N)) +
  geom_line(aes(x=distance, y=C+25), linetype = "dashed") +
  geom_point(aes(x=distance, y=C+25)) +
  labs(x= NULL, y=expression(paste(delta^15, "N (\u2030)" )), tag = "A")  +
  scale_y_continuous(sec.axis = sec_axis(~.-25, name = NULL), 
                     breaks= c(9, 11, 13, 15), limits = c(8.5,15)) +
  theme(axis.title = element_text(size=18, face = "bold"), 
        axis.text= element_text(size = 14, face = "bold"), 
        legend.position = "none", legend.title = element_blank(), 
        plot.title = element_text(size = 18, face = "bold", hjust = 0.5)) +
  ggtitle("520")

b <- ggplot(data=filter(whisker, OtterID=="163521")) +   theme_few() +
  geom_line(aes(x=distance, y=N)) + 
  geom_point(aes(x=distance, y=N)) +
  geom_line(aes(x=distance, y=C+25), linetype = "dashed") +
  geom_point(aes(x=distance, y=C+25)) +
  labs(x= NULL, y= NULL, tag = "B")  +
  scale_y_continuous(sec.axis = sec_axis(~.-25,
                                         name = expression(paste(delta^13, "C (\u2030)" ))), 
                     breaks= c(9, 11, 13, 15), limits = c(8.5,15)) +
  theme(axis.title = element_text(size=18, face = "bold"), 
        axis.text= element_text(size = 14, face = "bold"),
        legend.position = "none", legend.title = element_blank(),
        plot.title = element_text(size = 18, face = "bold", hjust = 0.5)) +
  ggtitle("521")

c <- ggplot(data=filter(whisker,OtterID=="200752")) +   theme_few() +
  geom_line(aes(x=distance, y=N)) + 
  geom_point(aes(x=distance, y=N)) +
  geom_line(aes(x=distance, y=C+25), linetype = "dashed") +
  geom_point(aes(x=distance, y=C+25)) +
  labs(x= "Distance from root (cm)", y=expression(paste(delta^15, "N (\u2030)" )), tag = "C")  +
  scale_y_continuous(sec.axis = sec_axis(~.-25, name = NULL), 
                     breaks= c(9, 11, 13, 15), limits = c(8.5,15)) +
  xlim(0,6) +
  theme(axis.title = element_text(size=18, face = "bold"), 
        axis.text= element_text(size = 14, face = "bold"), 
        legend.position = "none", legend.title = element_blank(), 
        plot.title = element_text(size = 18, face = "bold", hjust = 0.5)) +
  ggtitle("524")

d <-ggplot(data=filter(whisker, OtterID=="77287")) +   theme_few() +
  geom_line(aes(x=distance, y=N)) + 
  geom_point(aes(x=distance, y=N)) + 
  geom_line(aes(x=distance, y=C+25), linetype = "dashed") +
  geom_point(aes(x=distance, y=C+25)) +
  labs(x= "Distance from root (cm)", y=NULL, tag = "D")  +
  xlim(0,6) +
  scale_y_continuous(sec.axis = sec_axis(~.-25, 
                                         name = expression(paste(delta^13, "C (\u2030)" ))), 
                     breaks= c(9, 11, 13, 15), limits = c(8.5,15)) +
  theme(axis.title = element_text(size=18, face = "bold"), 
        axis.text= element_text(size = 14, face = "bold"), 
        legend.position = "none", legend.title = element_blank(),
        plot.title = element_text(size = 18, face = "bold", hjust = 0.5)) +
  ggtitle("287")

return(grid.arrange(a, b, c, d, nrow=2))
```



# Seasonal changes 

δ13C and δ15N means for each season as derived from sea otter vibrissae segments and site where the sea otter was harvested. Seasons were estimated from vibrissae growth rates and sample distance from the root.

### Carbon

```{r, boxplot Carbon seasons, warning=FALSE, message=FALSE}
ggplot(data=whisker) +
  geom_boxplot(aes(x=Season, y=C, fill=Site)) +
  labs(y=expression(paste(delta^13, "C" ))) +
  scale_fill_brewer(palette = "Greens") +
  theme_few()
```

### Nitrogen

```{r, boxplot Nitrogen seasons, warning=FALSE, message=FALSE}
ggplot(data=whisker) +
  geom_boxplot(aes(x=Season, y=N, fill=Site)) +
  labs(y=expression(paste(delta^15, "N" ))) +
  scale_fill_brewer(palette = "Purples") +
  theme_few()
```


# Sea otter Biplot

```{r, prey means and TDFs, include=FALSE}
si.mean <-si.prey %>%
  group_by(PreyCat) %>% 
  summarise(Cmean=mean(Cnorm), Nmean=mean(N), Csd=sd(Cnorm), Nsd=sd(N)) %>%
  drop_na(PreyCat)

si.mean$Cmean<-si.mean$Cmean+2
si.mean$Nmean<-si.mean$Nmean+2.8
```


δ13C and δ15N values for sea otters (as determined by vibrissae) and their prey (with standard deviation error bars). Sea otter prey values are corrected for trophic discrimination by subtracting 2‰ and 2.8‰ from carbon and nitrogen isotope values respectively. Carbon values are normalized for lipid content. Each season is derived from estimated growth rates of sea otter vibrissae and sample distance from the root. Each site is where the sea otter was harvested. 

```{r, seasonal biplot sd, message=FALSE, warning=FALSE}
ggplot() +
  geom_point(data=si.mean, aes(x=Cmean, y=Nmean), size = 3) +
  labs(x=expression(paste(delta^13, "C (\u2030)")), 
       y=expression(paste(delta^15, "N (\u2030)" )))  +
  geom_errorbar(data= si.mean, aes(x= Cmean, y= Nmean, ymin = Nmean-Nsd, ymax = Nmean+Nsd, linetype= PreyCat), width=0) + 
  geom_errorbarh(data= si.mean, aes(x= Cmean, y=Nmean, xmin = Cmean-Csd,xmax = Cmean+Csd, linetype= PreyCat), height=0) +
  geom_point(data=whisker, aes(x=C, y=N, shape=Site, color=Season), size=2)+
  geom_text(data= si.mean, aes(x= Cmean, y=Nmean, label=PreyCat),hjust=-0.2, vjust=1.8, size = 6) +
  theme_few() +
  labs(colour = "Season", shape = "Site") +
  guides(linetype=FALSE) +
  theme(axis.text = element_text(size = 14), axis.title = element_text(size = 16), legend.text = element_text(size = 16), 
        legend.title = element_text(size = 16, face = "bold"))
```


# Mixing Model Results


```{r, mixing model, include=FALSE}
#load prey data
all <- read.csv("all_mixing_new.csv")
all$Season<-factor(all$Season , levels=c("Spring", "Summer", "Fall", "Winter"))
```


### Sea otter diets by Site and Season

Boxplots showing estimated diets by harvest location and season for the five functional prey groups from an informed mixing model. Boxes are upper and lower quantiles with a mean horizontal line, and whisker is 95% credible interval.

```{r, box whisker mixing, message=FALSE, warning=FALSE}
ggplot(aes(y = value, x = source, fill = source), data = all) + 
  geom_boxplot(outlier.colour = NA) +
  theme_few() +
  xlab(NULL) +
  scale_y_continuous(labels = scales::percent_format(accuracy = 1)) +
  ylab("Diet proportion") +
  facet_grid(Season~Site) +
  theme( axis.title=element_text(size=16), legend.position = "none", 
         axis.text.x = element_text(angle = -45, hjust=0, size =12), 
         axis.text.y = element_text(size = 12),
         strip.text=element_text(size = 12, face="bold"))
```



