---
title: "LME - carbon"
author: "Nicole LaRoche"
date: "3/9/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, libraries and data, message= FALSE}
library(ggplot2)
library(dplyr)
library(ggthemes)
library(lme4)

#load whisker data
whisker <- read.csv("whiskers.csv")
whisker$OtterID<-as.character(whisker$OtterID)
whisker<- filter(whisker, OtterID != "163532")
whisker$Season<-factor(whisker$Season , levels=c("Spring", "Summer", "Fall", "Winter"))
```

### Boxplot of Carbon means across seasons

```{r, boxplot Carbon seasons, echo=FALSE, message=FALSE}
ggplot(data=whisker) +
  geom_boxplot(aes(x=Season, y=C)) +
  labs(y=expression(paste(delta^13, "C" ))) +
  theme_few()
```


### LME 

First, I am interested in Carbon values, and the effect Season has on these values. But there is some sort of interaction because the 289 samples come from only 29 otters. I was thinking that I would want to make a model `C ~ Season + (Season | OtterID)` but that produced a warning because I didn't have enough degrees of freedom. So then I replaced season in the random factor with 1 (because I have seen this in a lot of examples). This didn't give me errors. I also can't 100% explain why this is "correct" 

```{r LME, message =FALSE}
test.model <- lmer(C~Season + (1 | OtterID), data = whisker)
summary(test.model)
```



### Residuals from model above

Looks skewed, but no large values

```{r residual visualizations, echo = FALSE}
plot(test.model)

```

```{r anova for both}
anova(test.model)
```


```{r lm}
LM <- lm(C ~ Season+OtterID, data=whisker)
summary(LM)
plot(LM)
```

```{r glm}
GLM <- gls(C ~ Season + OtterID, data=whisker, method = "ML")
summary(GLM)
```


```{r}
lmmc <- lme(C ~ Season, data=whisker,
random = ~1|OtterID)
anova(lmmc)
summary(lmmc)

lmmn <- lme(N ~ Season, data=whisker,
random = ~1|OtterID)
anova(lmmn)
```

```{r residuals}
plot(lmmc)
```

```{r qq plot}
qqnorm(resid(lmmc, type = "normalized"), main = "lmmc")
```

