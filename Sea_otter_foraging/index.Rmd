---
title: "Sea otter seasonal diet composition in Southeast Alaska"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r, sea otter photo, echo= FALSE}
knitr::include_graphics("SI/whisker_mag.jpg")
```

```{r, libraries, echo=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
library(ggthemes)
```

```{r, load prey, echo=FALSE, message=FALSE}
si.test <- read.csv("SI/SI.csv")
#until final data is run, delete rows 205-272
si.test<-si.test[-c(205:272), ] 

#make new line with overall prey cat
si.test$PreyCat <- NA
si.test$PreyCat <- ifelse(si.test$Species == "apc", "Cucumber", 
                   ifelse(si.test$Species == "cln" | si.test$Species == "prs" | si.test$Species == 
                            "sag", "Clam", 
                   ifelse(si.test$Species == "cam" | si.test$Species == "cap" | si.test$Species == "cao"                              | si.test$Species == "tec" | si.test$Species == "pup", "Crab", 
                   ifelse(si.test$Species == "cef" | si.test$Species == 
                            "nul", "Snail",
                   ifelse(si.test$Species == "tes", "Tegula",
                   ifelse(si.test$Species == "pio" | si.test$Species == "evt", "Star",
                   ifelse(si.test$Species == "std" | si.test$Species == "stf", "Urchin",
                   ifelse(si.test$Species == "mtr", "Mussel",""))))))))
```

```{r, carbon norm, echo=FALSE}
### Fixing C for high fat critters. Anything above 3.5:1 ratio
si.test$Cnorm <- NA
si.test$Cnorm<- ifelse(si.test$CN >= 3.5, si.test$C-3.32+(0.99*si.test$CN), si.test$C)
si.test$SiteNumber<-as.character(si.test$SiteNumber)
```

```{r, load whiskers, echo=FALSE}
whisker <- read.csv("SI/whiskers.csv")
whisker$OtterID<-as.character(whisker$OtterID)

# for right now, I want to remove 163532. I removed 160478 and 77298 from the CSV
oddotter<- filter(whisker, OtterID=="163532")
whisker<- filter(whisker, OtterID != "163532")

#right now, removing last row because it only has one obs
whisker<-whisker[-286, ] 

#Shortening to only 8cm max for graphs
whisker.short<-filter(whisker, distance < 7.5)
```

```{r, min/max prey, echo=FALSE}
si.mean <-si.test %>%
  group_by(PreyCat) %>% 
  summarise(Cmean=mean(Cnorm), Nmean=mean(N), Cmin=min(Cnorm), Cmax= max(Cnorm), 
            Csd=sd(Cnorm), Nsd=sd(N), Cse=sd(Cnorm)/sqrt(length(Cnorm)), Nse=sd(N)/sqrt(length(N)))
si.mean<-si.mean[-1,] #removing blank
si.mean<-si.mean[-6,] #removing stars
```

```{r, mean standardized to mussels, echo=FALSE, results="hide"}
Cmussel<-filter(si.test, Site=="Craig" & PreyCat== "Mussel")
Smussel<-filter(si.test, Site=="Soda Bay" & PreyCat== "Mussel")

(mean(Smussel$Cnorm))#  -18.40197
(mean(Smussel$N))#  8.195714
(mean(Cmussel$Cnorm))#  -16.52315
(mean(Cmussel$N))#  9.426667
(mus.n<-mean(Cmussel$N)-mean(Smussel$N))#  1.230952
(mus.c<-mean(Cmussel$Cnorm)-mean(Smussel$Cnorm))#1.878819

si.test$Cadjust<-NA
si.test$Nadjust<-NA
si.test$Cadjust<-ifelse(si.test$Site=="Soda Bay",si.test$Cnorm+mus.c,si.test$Cnorm)
si.test$Nadjust<-ifelse(si.test$Site=="Soda Bay",si.test$N+mus.n,si.test$N)

si.mean <-si.test %>%
  group_by(PreyCat) %>% 
  summarise(Cmean=mean(Cadjust), Nmean=mean(Nadjust), Csd=sd(Cadjust), Nsd=sd(Nadjust), 
            Cse=sd(Cadjust)/sqrt(length(Cadjust)), Nse=sd(Nadjust)/sqrt(length(Nadjust)))
si.mean<-si.mean[-1,] #removing blank
si.mean<-si.mean[-6,] #removing stars

```

```{r, tdf whiskers, echo=FALSE}

whis.mean<-whisker %>%
  group_by(OtterID) %>%
  summarise(Cmean=mean(C), Nmean=mean(N), Csd=sd(C), Nsd=sd(N), 
            Cse=sd(C)/sqrt(length(C)), Nse=sd(N)/sqrt(length(N)), 
            Crange=(max(C)-min(C)), Nrange=max((N)-min(N)))


whis.mean$TDFC<-NA; whis.mean$TDFN<-NA
whis.mean$TDFC <- whis.mean$Cmean-2
whis.mean$TDFN <- whis.mean$Nmean-2.8
```

### Seasonal changes - Carbon

Overall there are no changes and the model `ln(C~distance*OtterID)` was not significant when looking at the residuals from the mean.
```{r, residuals, echo=FALSE}
MEANS<-whisker.short%>%
  group_by(OtterID)%>%
  summarise(MC=mean(C),
            MN=mean(N))

whisk<-left_join(whisker.short, MEANS, by="OtterID")
whisk$Cr<-whisk$C-whisk$MC
whisk$Nr<-whisk$N-whisk$MN
```

```{r,C ANOVA for residuals}
cfit<-lm(Cr~distance*OtterID, whisk)
summary(cfit)
```



#### Here is the graph I used on the last poster. I do like it, but I think it takes explaining to understand what is going on. 
Distance is time, and over time there is no change in the mean carbon.
```{r, old carbon graph, echo= FALSE, message= FALSE}
ggplot(data=whisk, aes(x=distance, y=C)) +   theme_few() +
  geom_point() +
  geom_smooth(size=2, span=0.8, se= FALSE, show.legend = FALSE, colour="lightseagreen") +
  labs(x= "Distance from root (cm)", 
       y=expression(paste(delta^13, "C(\u2030)" ))) +
  theme(axis.title = element_text(size=14))
```

So I thought about how to portray this more simply, and also since my title says "seasonal" how to add in the seasonal aspect.

Here are histograms of carbon for each season. Overall, not much change.
```{r, carbon histos by season, echo=FALSE}
ggplot(data=whisker.short) +   
    theme_few() +
    geom_histogram(aes(x=C, fill = Season), bins = 15) +
    labs(x= "Count", 
           x=expression(paste(delta^13, "C(\u2030)" ))) +
    facet_wrap(vars(Season)) +
  theme(axis.title = element_text(size=14))
```


And then using density to smooth out the graphs, and overlay one on top of one another.

```{r, carbon graph overlaid seasons, echo=FALSE}
ggplot() +   
  theme_few() +
  geom_density(data=filter(whisker.short, Season == "Summer"), 
                 aes(x=C), alpha=.5, fill= "darkgoldenrod1") +
  geom_density(data=filter(whisker.short, Season == "Spring"), 
                 aes(x=C), alpha=.5, fill= "palegreen3") +
  geom_density(data=filter(whisker.short, Season == "Fall"), 
                 aes(x=C), alpha=.5, fill= "darkorange3") +
  geom_density(data=filter(whisker.short, Season == "Winter"), 
                 aes(x=C), alpha=.5, fill = "paleturquoise1") +
  labs(x=expression(paste(delta^13, "C (\u2030)" ))) +
  theme(axis.title = element_text(size=14))
```

That is pretty messy, so I decided that Alaska really has two seasons - cold and warm. So here are the spring/summer months and the fall/winter months separated. Which is the final product that I am happy with.

```{r, carbon graph overlaid 2 seasons, echo=FALSE}
ggplot() +   
  theme_few() +
  geom_density(data=filter(whisker.short, Season == "Fall" | Season == "Winter"), 
               aes(x=C), alpha=.5, fill= "lightseagreen") +
  geom_density(data=filter(whisker.short, Season == "Spring"| Season =="Summer"), 
               aes(x=C), alpha=.5, fill= "darkgoldenrod1") +
  labs(x=expression(paste(delta^13, "C (\u2030)" ))) +
  theme(axis.title = element_text(size=14))
```

**Note that these need legends, I will get that on there 



### Seasonal changes - Nitrogen

So Carbon has no real change over time, but Nitrogen tells a little different story

```{r, ANOVA for residuals}
nfit<-lm(Nr~distance*OtterID, whisk)
summary(nfit)
```

This shows that distance is significant for the model `ln(N~distance*OtterID)` but the R^2 is still rather low.

For a comparison with the carbon graph above, here is the original Nitrogen graph used in the last poster.

```{r, old nitrogen graph, echo= FALSE, message= FALSE}
ggplot(data=whisk, aes(x=distance, y=N)) +   theme_few() +
  geom_point() +
  geom_smooth(size=2, span=0.8, se= FALSE, show.legend = FALSE, colour="tomato") +
  labs(x= "Distance from root (cm)", 
       y=expression(paste(delta^15, "N(\u2030)" )), tag = "B") +
  theme(axis.title = element_text(size=14))
```

And here is the final product with two seasons

```{r, nitrogen 2 seasons, echo=FALSE}
ggplot() +   
  theme_few() +
  geom_density(data=filter(whisker.short, Season == "Fall" | Season == "Winter"), 
               aes(x=N), alpha=.5, fill= "lightseagreen") +
  geom_density(data=filter(whisker.short, Season == "Spring"| Season =="Summer"), 
               aes(x=N), alpha=.5, fill= "darkgoldenrod1") +
  labs(x=expression(paste(delta^15, "N (\u2030)" ))) +
  theme(axis.title = element_text(size=14))
```

#### TAKEAWAY
There is a distinct difference with a much smaller overlap than the carbon graph, but the mean change is only 1 per mil. So, with that this is not showing a drastic trophic shift in prey, but more influenced by small 'partial' diet shifts. So otters are eating a lot of clams. They are always eating a lot of clams, but seasonally the other diet inputs can vary.



#### This is also interesting to add, the prey carbon and nitrogen values do not change over the seasons.
```{r, N Prey 2 seasons, echo=FALSE}
ggplot() +   
  theme_few() +
  geom_density(data=filter(si.test, Season == "Summer"| Season == "Spring"), 
               aes(x=N), alpha=.5, fill= "darkgoldenrod1") +
  geom_density(data=filter(si.test, Season == "Winter"), 
               aes(x=N), alpha=.5, fill = "lightseagreen") +
  labs(x=expression(paste(delta^15, "N (\u2030)" ))) +
  theme(axis.title = element_text(size=14))
```

```{r C Prey 2 seasons, echo=FALSE}
ggplot() +   
  theme_few() +
  geom_density(data=filter(si.test, Season == "Summer"| Season == "Spring"), 
               aes(x=C), alpha=.5, fill= "darkgoldenrod1") +
  geom_density(data=filter(si.test, Season == "Winter"), 
               aes(x=C), alpha=.5, fill = "lightseagreen") +
  labs(x=expression(paste(delta^13, "C (\u2030)" ))) +
  theme(axis.title = element_text(size=14))
```

