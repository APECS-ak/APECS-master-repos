---
title: "Untitled"
author: "Tiff Stephens"
date: "11/13/2018"
output: html_document
editor_options: 
  chunk_output_type: console
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(dplyr)
library(plyr)
library(tidyr)
library(lubridate)
library(ggplot2)
library(ggpmisc)

theme_set(theme_classic())
```



```{r}
df.matter <- read.csv("~/Desktop/R Studio/APECS-master-repos/ALL_DATA/TIFF_sediment/sediment_prelim.csv", stringsAsFactors = FALSE, header = TRUE)
```




```{r}
# calculate dry bulk density (DBD)
df.matter = df.matter %>% 
  mutate(sed_ww_pre_60C = bag_sed_ww_g - bag_weight_g) %>% # not needed for DBD but a good factor to have for later ww:dw conversions
  mutate(sed_dw_post_60C = bag_sed_dw_g - bag_weight_g) %>%
  mutate(dry_bulk_density = sed_dw_post_60C / sample_volume_cm3)




# calculate organic matter (OM)
df.matter = df.matter %>% 
  mutate(sed_dw_pre_450C = pan_sed_dw_pre_450C_g - pan_weight_g) %>%
  mutate(sed_dw_post_450C = pan_sed_dw_post_450C_g - pan_weight_g) %>%
  mutate(organic_dw_g = sed_dw_pre_450C - sed_dw_post_450C)


  

# calculate inorganic matter (IM)
#df.matter = df.matter %>%   
  #mutate(sed_dw_pre_950C = crucible_sed_dw_pre_950C - crucible_weight, na.rm = TRUE) %>%
  #mutate(sed_dw_post_950C = crucible_sed_dw_post_950C - crucible_weight, na.rm = TRUE) %>%
  #mutate(inorganic_dw_g = sed_dw_pre_950C - sed_dw_post_950C)
```



```{r}
# calculate other important data
df.matter = df.matter %>% 
  mutate(organic_dw_percent = (organic_dw_g / sed_dw_pre_450C) * 100) %>%
  #mutate(inorganic_dw_percent = (inorganic_dw_g / sed_dw_pre_950C) * 100, na.rm = TRUE) %>%
  mutate(organic_density = organic_dw_g * dry_bulk_density) %>%
  #mutate(inorganic_density = inorganic_dw_g * dry_bulk_density, na.rm = TRUE)
  mutate(organic_carbon_percent = (0.3134 * organic_dw_percent) - 0.1149) %>%
  mutate(organic_carbon_g = (organic_carbon_percent / 100) * sed_dw_pre_450C) %>%
  mutate(sed_dw_surface_m_g = sed_dw_pre_450C * 2608.695652) %>%
  mutate(om.sed = organic_dw_g /sed_dw_pre_450C) %>%
  mutate(tot.om.surface = om.sed * sed_dw_surface_m_g) %>%
  mutate(tot.carb.surface = tot.om.surface * (organic_carbon_percent /100))


df.matter <- df.matter[, -c(7:10)] # remove these columns
df.matter <- df.matter[, -c(7:9)] # remove these columns
```

```{r}
df.matter <- df.matter[, -c(7, 8, 10, 11)] # remove these columns
```


```{r}
dbd.agg <- aggregate(dry_bulk_density ~ site + transect, data = df.matter, mean, na.rm = TRUE)
org.g.agg <- aggregate(organic_dw_g ~ site + transect, data = df.matter, mean, na.rm = TRUE)
org.p.agg <- aggregate(organic_dw_percent ~ site + transect, data = df.matter, mean, na.rm = TRUE)
org.d.agg <- aggregate(organic_density ~ site + transect, data = df.matter, mean, na.rm = TRUE)
#carb.g.agg <- aggregate(organic_carbon_g ~ site + transect, data = df.matter, mean, na.rm = TRUE)
carb.p.agg <- aggregate(organic_carbon_percent ~ site + transect, data = df.matter, mean, na.rm = TRUE)
carb.m.agg <- aggregate(tot.carb.surface ~ site + transect, data = df.matter, mean, na.rm = TRUE)


df.carbon <- inner_join(x = dbd.agg, y = carb.p.agg)
df.carbon <- inner_join(x = df.carbon, y = org.g.agg)
df.carbon <- inner_join(x = df.carbon, y = carb.m.agg)
df.carbon <- inner_join(x = df.carbon, y = org.p.agg)
df.carbon <- inner_join(x = df.carbon, y = org.d.agg)

```






```{r}
sites.2018 <- read.csv("/Users/tiff/Desktop/R Studio/APECS-master-repos/ALL_DATA/TIFF_seagrass/2018_data_efforts/alldat.csv", stringsAsFactors = FALSE, header = TRUE) # import site data

```






