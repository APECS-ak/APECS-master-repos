---
title: '---in_progress(Sea_otter_impact_index_full)'
author: "Wendel Raymond"
date: "December 14, 2017"
output: html_document
editor_options: 
  chunk_output_type: console
---

# Sea otter impact index
Sea otters are hard to keep track of. Until the 2017 field season the most reliable measure of sea otters in the Prince of Wales Island region were the USFWS aerial surveys. These data provided densities and time since occupation of sea otters. However the most recent survey was done in 2011. In an effort to add more resolution to how we think about sea otters we collected a variety of sea otter impact measures over the 2017 field season. This script summaries and then combined these measures to create a sea otter impact index. 

In this script we will calcualte the sea otter impact index from raw data to final index. This will be in contrast to relying on hard to track ArcGIS processing.

## Packages
Since we will be working with spatial data we need to load a bunch of packages that deal with spatial data.
```{r libraries}
library(dplyr)
library(dplyr)
library(ggplot2)
library(spatstat)
library(maptools)
library(rgdal)
library(rgeos)
library(raster)
library(gdistance)
library(leaflet)
```

## Data
You will need data on.
1. Sites from which sea otter surveys were centered from (points)
2. Sea otter survey data (points with an "n sea otter" data attribute)
3. The 2003 and 2010 USFWS aerial surveys distribution polygons
4. Tim's, in review, survey population density polygons 
```{r data}
## Sites ##
sites <- readOGR(dsn = "C:/Users/Wendubs/Documents/Graduate School/Eelgrass/Data/2017 Field Season/GIS", layer = "Otter_Survey_Sites_2017_All_UTM")
sites <- sites[1:39,] # remove the blank row thats in there

## Sea otters that where observed ##
otts <- readOGR(dsn = "C:/Users/Wendubs/Documents/Graduate School/Eelgrass/Data/2017 Field Season/GIS", layer = "Otter_Survey_All_17Oct17_UTM")
otts@data$n_otters <- as.numeric(otts@data$n_otters) # data is imported as a factor

## USFWS polygons ##
# 2003 Sea Otters
sd2003 <- readOGR(dsn = "C:/Users/Wendubs/Documents/Graduate School/GIS General/Sea Otter Distribution Polygons/South SEAK Sea Otter Distribution Polygons", layer="Clipped sea otter dist_2003") 

# 2010 Sea Otters
sd2010 <- readOGR(dsn = "C:/Users/Wendubs/Documents/Graduate School/GIS General/Sea Otter Distribution Polygons/South SEAK Sea Otter Distribution Polygons", layer="Clipped sea otter dist_2010") 

## Tim's survey density blocks ##
```

## Plot sites and sea otters
```{r plotting everything}
leaflet() %>% 
  addTiles() %>% 
  addPolygons(data = sd2010, stroke = NA, fillColor = "orange", fillOpacity = 0.8, group = "2014") %>% 
  addPolygons(data = sd2003, stroke = NA, fillColor = "blue", fillOpacity = 0.8, group = "2010") %>%
  addMarkers(data = sites, ~longitude, ~latitude, label = ~site) %>% 
  addCircleMarkers(data = otts, ~longitude, ~latitude, color = "red", stroke = FALSE, radius = 5, fillOpacity = ~(n_otters/max(n_otters)))
```

